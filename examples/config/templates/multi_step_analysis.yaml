name: multi_step_analysis
description: "Multi-step analysis demonstrating named outputs and variable substitution"
version: 1.0.0

metadata:
  category: analysis
  tags:
    - multi-step
    - advanced
  author: Development Team

config:
  variables:
    company_name: "Example Corp"
  
  defaults:
    provider: openai
    model: gpt-4o-mini
    temperature: 0.3
    timeout: 120s

steps:
  # Step 1: Initial analysis
  - name: initial_analysis
    description: "Perform initial analysis of the input data"
    
    system_prompt: "You are a data analyst. Provide clear, concise analysis."
    
    prompt: |
      Analyze this data for {{company_name}}:
      {{input_data}}
      
      Provide:
      1. Key findings
      2. Potential issues
      3. Recommendations
    
    servers: []
    temperature: 0.5
    output: initial_findings
  
  # Step 2: Deep dive analysis (uses output from step 1)
  - name: deep_dive
    description: "Perform detailed analysis based on initial findings"
    
    system_prompt: "You are a senior analyst. Provide detailed technical analysis."
    
    prompt: |
      Based on these initial findings:
      {{initial_findings}}
      
      Provide detailed technical analysis:
      1. Root cause analysis
      2. Impact assessment
      3. Detailed action plan
    
    servers: []
    output: detailed_analysis
  
  # Step 3: Quality check (uses both previous outputs)
  - name: quality_check
    description: "Validate the quality of our analysis"
    
    system_prompt: "You are a quality assurance specialist."
    
    prompt: |
      Quality Review:
      
      Original Data: {{input_data}}
      Initial Analysis: {{initial_findings}}
      Detailed Analysis: {{detailed_analysis}}
      
      Score the analysis quality (1-10) and provide improvement suggestions.
    
    servers: []
    output: qa_results
    
    error_handling:
      on_failure: continue
      max_retries: 2
  
  # Step 4: Final report
  - name: final_report
    description: "Compile final comprehensive report"
    depends_on:
      - initial_analysis
      - deep_dive
    
    prompt: |
      Create final report for {{company_name}}:
      
      ## INITIAL FINDINGS
      {{initial_findings}}
      
      ## DETAILED ANALYSIS
      {{detailed_analysis}}
      
      ## QUALITY ASSESSMENT
      {{qa_results}}
      
      Compile into executive-ready format.
    
    servers: []
    output: final_report
