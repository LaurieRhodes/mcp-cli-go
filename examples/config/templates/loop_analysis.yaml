name: loop_analysis
description: "Demonstrates loop/iteration over multiple items"
version: 1.0.0

metadata:
  category: phase2
  tags:
    - loop
    - iteration
    - demo
  author: Dev Team

config:
  defaults:
    provider: openai
    model: gpt-4o-mini
    temperature: 0.5

steps:
  # Step 1: Parse input into items list
  - name: prepare_items
    description: "Prepare list of items to analyze"
    
    system_prompt: "You are a data processor. Extract items from input and return as JSON array."
    
    prompt: |
      Extract individual items from this input and return as JSON array:
      {{input_data}}
      
      Return ONLY a JSON array like: ["item1", "item2", "item3"]
    
    servers: []
    output: items_list
  
  # Step 2: Analyze each item
  - name: analyze_items
    description: "Analyze each item individually"
    for_each: items_list
    item_name: current_item
    
    prompt: |
      Analyze this item ({{index}} of {{items_list | length}}):
      {{current_item}}
      
      Provide a brief analysis focusing on key characteristics.
    
    servers: []
    output: item_analyses
  
  # Step 3: Summarize all analyses
  - name: summary
    description: "Summarize all item analyses"
    depends_on:
      - analyze_items
    
    prompt: |
      Here are analyses of multiple items:
      {{item_analyses}}
      
      Provide a comprehensive summary highlighting:
      1. Common themes
      2. Key differences
      3. Overall insights
    
    servers: []
    output: final_summary
