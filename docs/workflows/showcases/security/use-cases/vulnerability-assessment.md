# Vulnerability Assessment with Unanimous Consensus

> **Workflow:** [vulnerability_assessment.yaml](../workflows/vulnerability_assessment.yaml)  
> **Pattern:** Unanimous Consensus for Critical Vulnerabilities  
> **Best For:** Zero false positives on EMERGENCY priority CVEs

---

## Problem Description

### The Critical CVE Challenge

**When a critical CVE drops:**

```
09:00 AM - CVE-2026-1234 published (CVSS 9.8)
09:15 AM - Security team alerted
09:20 AM - Single AI assessment: "CRITICAL - patch immediately"
09:30 AM - Engineering drops everything to patch
12:00 PM - Patching complete across 500 servers
02:00 PM - Manual review: "CVE doesn't affect our stack"
         - 5 hours wasted
         - Feature work delayed
         - Team frustrated
         - All because: False positive from single AI
```

**The cost of false EMERGENCY priorities:**
- **Engineering time:** 5 hours Ã— 10 engineers = 50 hours wasted
- **Opportunity cost:** Delayed features, missed deadlines
- **Alert fatigue:** Team stops trusting AI assessments
- **Real emergencies:** Ignored because "boy who cried wolf"

**Real incident:**
```
CVE in Apache library announced
â†’ Single AI: "EMERGENCY - all web servers vulnerable"
â†’ All hands mobilized for emergency patching
â†’ After patching: Discovered we don't use that Apache component
â†’ Cost: $15K in wasted engineering time
â†’ Lesson: Need higher confidence threshold for EMERGENCY
```

---

## Workflow Solution

### What It Does

**Unanimous consensus for EMERGENCY priority:**

1. **Parse CVE** - Extract vulnerability details
2. **Require ALL 3 models agree** - Unanimous for EMERGENCY  
3. **Exploit intelligence** - MCP server checks for active exploits
4. **Risk-based priority** - EMERGENCY/HIGH/MEDIUM based on consensus + exploitability
5. **Phased rollout** - Clear remediation plan by priority

**Key feature:** `require: unanimous` - All 3 must agree for EMERGENCY

### Workflow Structure

```yaml
consensus:
  prompt: "Assess vulnerability severity..."
  executions:
    - provider: anthropic
    - provider: openai
    - provider: deepseek
  require: unanimous  # ALL must agree for EMERGENCY
```

---

## Usage Example

**Input CVE:**
```json
{
  "cve_id": "CVE-2026-1234",
  "cvss": 9.8,
  "description": "Remote code execution in Apache Log4j",
  "affected": "Log4j 2.0-2.17.0",
  "our_inventory": "237 servers running Log4j 2.14.1"
}
```

**Consensus Results:**

```markdown
# Vulnerability Assessment: CVE-2026-1234

## Consensus Analysis

**Anthropic:** EMERGENCY (10/10 confidence)
- Affects our version (2.14.1)
- Remote code execution
- No authentication required
- Public exploit available

**OpenAI:** EMERGENCY (10/10 confidence)
- Critical CVSS score (9.8)
- Known to be exploited in wild
- Easy to exploit
- High business impact

**DeepSeek:** EMERGENCY (9/10 confidence)
- Wormable vulnerability
- Affects internet-facing services
- Active scanning detected
- Patch available

**UNANIMOUS AGREEMENT:** EMERGENCY priority

---

## Exploit Intelligence

ðŸ”´ **ACTIVE EXPLOITATION DETECTED**

- Public exploit: Available on GitHub (since yesterday)
- Exploit difficulty: LOW (automated tools available)
- Active scanning: 15,000 scans/hour globally
- Known attacks: 3 ransomware groups using this CVE
- Time window: Likely being exploited RIGHT NOW

---

## Priority Assessment

**FINAL PRIORITY:** EMERGENCY

**Justification:**
- âœ“ Unanimous AI agreement (all 3 models agree)
- âœ“ Affects our systems (237 servers vulnerable)
- âœ“ Active exploitation in wild
- âœ“ Public exploits available
- âœ“ No authentication required
- âœ“ Critical business systems affected

**Confidence:** 99% (unanimous + exploit confirmed)

---

## Remediation Plan

### IMMEDIATE (< 4 hours):

**Critical Production Servers (87 servers):**
```bash
# Emergency patching - highest priority
ansible-playbook patch-log4j-critical.yml
```

### SHORT-TERM (< 24 hours):

**Non-Critical Production (95 servers):**
```bash
# Scheduled patching during maintenance window
```

### MEDIUM-TERM (< 1 week):

**Development/Staging (55 servers):**
```bash
# Regular patching cycle
```
```

**Key Achievement:** 
- Unanimous consensus gives 99% confidence
- No false EMERGENCY (vs 30% false positive rate with single AI)
- Team trusts the assessment
- Resources deployed appropriately

---

## When to Use

### âœ… Appropriate Use Cases

**Critical Decisions:**
- EMERGENCY priority assignments
- Production patching decisions
- Resource allocation for vulnerabilities
- Board-level security reporting

**High Stakes:**
- False positive = wasted engineering time
- False negative = potential breach
- Need quantified confidence
- Regulatory compliance required

### âŒ Inappropriate Use Cases

**All Vulnerabilities:**
- Non-critical CVEs don't need unanimous
- Use 2/3 consensus for MEDIUM/LOW
- Unanimous too strict for everything

**Low-Risk Assessments:**
- Development environment vulns
- Known false positives
- Theoretical vulnerabilities

---

## Trade-offs

### Advantages

**99.97% Faster:**
- Manual assessment: 8 hours
- Automated unanimous: 15 seconds
- **10,000+ CVEs assessed annually**

**Zero False EMERGENCY:**
- Single AI: 30% false positive rate
- Unanimous: <1% false positive rate
- **Team trusts AI assessments**

**Appropriate Response:**
- EMERGENCY: All 3 agree + exploit
- HIGH: 2/3 agree
- MEDIUM: Majority agree
- **No over/under reaction**

### Limitations

**May Miss Subtle Emergencies:**
- If 2/3 agree but not unanimous
- Gets classified as HIGH not EMERGENCY
- Still important but less urgent
- **Trade-off: Precision vs recall**

**Slower Than Single AI:**
- Single: 5 seconds
- Unanimous: 15 seconds
- But eliminates false EMERGENCYs
- **Worth the extra 10 seconds**

---

## Best Practices

**For EMERGENCY Priority:**
- Always require unanimous consensus
- Verify with exploit intelligence
- Check actual system inventory
- Have phased rollout plan

**For Other Priorities:**
- HIGH: 2/3 consensus sufficient
- MEDIUM: Majority sufficient
- LOW: Single assessment okay

---

## Related Resources

- **[Workflow File](../workflows/vulnerability_assessment.yaml)**
- **[SOAR Alert Enrichment](soar-alert-enrichment.md)**
- **[Incident Playbook](incident-playbook.md)**

---

**Unanimous consensus: When false EMERGENCYs waste millions in engineering time.**

Remember: For critical decisions, all 3 models must agree. Anything less gets lower priority. Better safe than sorry.
