name: market_opportunity_analysis
description: Multi-stage market sizing with template composition (research → extract → size → present)
version: 1.0.0
author: Business Intelligence Templates
tags: [business-intelligence, market-research, template-composition, tam-sam-som]

config:
  defaults:
    provider: anthropic
    model: claude-3-5-sonnet
    temperature: 0.3
    max_tokens: 8000

steps:
  # Stage 1: Market Research (simulates calling web_research_workflow template)
  - name: conduct_market_research
    prompt: |
      Conduct comprehensive market research for:
      
      **Market:** {{input_data.market}}
      **Geography:** {{input_data.geography | default: 'Global'}}
      **Time Horizon:** {{input_data.time_horizon | default: '5 years'}}
      
      Note: In production, this would call a `web_research_workflow` template
      that uses web search, web scraping, and document analysis.
      
      Research objectives:
      
      ## Market Overview
      - Industry definition and boundaries
      - Market maturity stage (emerging, growth, mature, declining)
      - Key market segments
      - Geographic distribution
      
      ## Market Size Data
      - Total addressable market (TAM) estimates
      - Historical growth rates (3-5 years)
      - Market forecasts and projections
      - Sources: Industry reports, analyst firms, public filings
      
      ## Competitive Landscape
      - Major players and market share
      - New entrants and innovations
      - Barriers to entry
      - Pricing dynamics
      
      ## Market Drivers
      - Technology trends
      - Regulatory changes
      - Economic factors
      - Customer behavior shifts
      
      ## Market Challenges
      - Headwinds and risks
      - Competitive threats
      - Technology disruption
      
      Return structured research findings:
      ```json
      {
        "market_overview": {
          "definition": "Description of market",
          "maturity": "growth",
          "segments": ["segment1", "segment2"],
          "regions": ["North America", "Europe", "APAC"]
        },
        "market_size": {
          "current_tam": "$50B",
          "historical_cagr": "15%",
          "projected_cagr": "18%",
          "five_year_projection": "$120B",
          "sources": ["Gartner", "IDC", "Company filings"]
        },
        "competitors": [
          {"name": "Company A", "market_share": "25%", "positioning": "Enterprise"},
          {"name": "Company B", "market_share": "15%", "positioning": "SMB"}
        ],
        "drivers": [
          "Digital transformation acceleration",
          "Remote work adoption",
          "AI/ML integration"
        ],
        "challenges": [
          "Economic uncertainty",
          "Talent shortage",
          "Privacy regulations"
        ]
      }
      ```
    output: research_data
  
  # Stage 2: Extract Structured Metrics (simulates calling data_extraction_workflow template)
  - name: extract_market_metrics
    prompt: |
      Extract structured metrics from research data:
      
      **Research Data:**
      {{research_data}}
      
      Note: In production, this would call a `data_extraction_workflow` template
      specialized in extracting numerical data and metrics from unstructured text.
      
      Extract and normalize:
      
      ## Market Size Metrics
      - Current TAM (in USD)
      - TAM growth rate (CAGR)
      - Market forecast (1 year, 3 years, 5 years)
      - Geographic breakdown
      - Segment breakdown
      
      ## Competitive Metrics
      - Number of competitors
      - Market concentration (HHI if available)
      - Top 3 player market share
      - Pricing ranges
      
      ## Growth Indicators
      - Historical growth rate (3-year CAGR)
      - Projected growth rate (next 5 years)
      - Acceleration or deceleration
      
      Return normalized metrics:
      ```json
      {
        "tam": {
          "current_usd": 50000000000,
          "currency": "USD",
          "year": 2024,
          "cagr_3yr": 0.15,
          "cagr_projected": 0.18
        },
        "projections": {
          "2025": 59000000000,
          "2026": 69620000000,
          "2027": 82151600000,
          "2028": 96938888000,
          "2029": 114387888400
        },
        "geography": {
          "north_america": 0.45,
          "europe": 0.30,
          "apac": 0.20,
          "other": 0.05
        },
        "competition": {
          "total_competitors": 47,
          "top3_share": 0.55,
          "market_concentrated": false
        }
      }
      ```
    output: market_metrics
  
  # Stage 3: TAM/SAM/SOM Analysis (simulates calling tam_analysis_workflow template)
  - name: calculate_tam_sam_som
    prompt: |
      Calculate TAM, SAM, and SOM for market opportunity:
      
      **Market Metrics:**
      {{market_metrics}}
      
      **Company Profile:**
      - Target Geography: {{input_data.target_geography}}
      - Target Segment: {{input_data.target_segment}}
      - Go-to-Market Strategy: {{input_data.gtm_strategy}}
      - Current Resources: {{input_data.current_resources}}
      
      Note: In production, this would call a `tam_analysis_workflow` template
      with standardized market sizing methodology.
      
      ## TAM (Total Addressable Market)
      Total market demand for product category if 100% market share achieved.
      
      Source: {{market_metrics.tam.current_usd}}
      
      ## SAM (Serviceable Available Market)
      Portion of TAM within our target geography and segment.
      
      Calculate:
      - Geographic focus: {{input_data.target_geography}} = X% of TAM
      - Segment focus: {{input_data.target_segment}} = Y% of geographic market
      - SAM = TAM × geographic_% × segment_%
      
      ## SOM (Serviceable Obtainable Market)
      Realistic market share achievable in 3 years.
      
      Consider:
      - Current competition ({{market_metrics.competition.total_competitors}} players)
      - Market concentration (Top 3 have {{market_metrics.competition.top3_share}}% share)
      - Our differentiation and GTM strategy
      - Resources available
      - Time to market
      
      Realistic SOM assumptions:
      - Year 1: 0.5-2% of SAM (early traction)
      - Year 2: 2-5% of SAM (scaling)
      - Year 3: 5-10% of SAM (established)
      
      Return TAM/SAM/SOM analysis:
      ```json
      {
        "tam": {
          "value_usd": 50000000000,
          "description": "Total global market for {{input_data.market}}",
          "growth_rate": 0.18,
          "year": 2024
        },
        "sam": {
          "value_usd": 7500000000,
          "description": "North America + Mid-market segment",
          "calculation": "TAM ($50B) × NA (45%) × Mid-market (33%) = $7.5B",
          "target_geography": "North America",
          "target_segment": "Mid-market (100-1000 employees)"
        },
        "som": {
          "year_1": {
            "value_usd": 37500000,
            "market_share": 0.005,
            "description": "0.5% of SAM - early traction"
          },
          "year_2": {
            "value_usd": 225000000,
            "market_share": 0.03,
            "description": "3% of SAM - scaling phase"
          },
          "year_3": {
            "value_usd": 525000000,
            "market_share": 0.07,
            "description": "7% of SAM - established player"
          }
        },
        "assumptions": [
          "Strong product-market fit in target segment",
          "Effective GTM execution",
          "$20M in funding for growth",
          "No major competitive disruption"
        ],
        "risks": [
          "Market growth slower than projected",
          "Incumbent response to new entrant",
          "Longer sales cycles than expected"
        ]
      }
      ```
    output: market_sizing
  
  # Stage 4: Competitive Positioning Analysis
  - name: analyze_competitive_position
    prompt: |
      Analyze competitive positioning and differentiation:
      
      **Research Data:**
      {{research_data}}
      
      **Market Sizing:**
      {{market_sizing}}
      
      **Our Value Proposition:**
      {{input_data.value_proposition}}
      
      Assess:
      
      ## Competitive Landscape
      - Who are the main competitors in our SAM?
      - What are their strengths and weaknesses?
      - Where are the gaps in the market?
      
      ## Differentiation
      - How do we differentiate from competitors?
      - What is our unique value proposition?
      - Which segment is underserved?
      
      ## Positioning Strategy
      - Where do we fit in the market?
      - Price positioning (premium, mid-market, value)
      - Target customer profile
      
      Return competitive analysis:
      ```json
      {
        "competitive_landscape": {
          "major_players": [
            {
              "name": "Incumbent A",
              "strengths": ["Brand recognition", "Enterprise relationships"],
              "weaknesses": ["Legacy technology", "Slow innovation"],
              "market_share_sam": 0.30
            }
          ],
          "market_gaps": [
            "Mid-market needs modern UX",
            "SMBs underserved by incumbents",
            "Integration capabilities limited"
          ]
        },
        "our_differentiation": {
          "key_differentiators": [
            "Modern AI-powered features",
            "Built for mid-market",
            "10× faster implementation"
          ],
          "target_segment": "Mid-market companies frustrated with enterprise tools",
          "positioning": "Modern alternative to legacy enterprise solutions"
        },
        "strategic_advantages": [
          "First-mover in AI integration for this segment",
          "Better economics for mid-market",
          "Faster time-to-value"
        ]
      }
      ```
    output: competitive_analysis
  
  # Stage 5: Generate Executive Presentation (simulates calling presentation_generator template)
  - name: create_executive_deck
    prompt: |
      Generate executive presentation content for market opportunity:
      
      **Market Research:** {{research_data}}
      **Market Sizing:** {{market_sizing}}
      **Competitive Analysis:** {{competitive_analysis}}
      
      Note: In production, this would call a `presentation_generator_workflow` template
      that creates actual PowerPoint slides with charts and formatting.
      
      Create presentation outline:
      
      # Market Opportunity: {{input_data.market}}
      
      ## Slide 1: Executive Summary
      
      **Market Opportunity:**
      - TAM: {{market_sizing.tam.value_usd | format_currency}}
      - SAM: {{market_sizing.sam.value_usd | format_currency}}
      - 3-Year SOM Target: {{market_sizing.som.year_3.value_usd | format_currency}}
      
      **Market Characteristics:**
      - Growth Rate: {{market_sizing.tam.growth_rate | format_percent}} CAGR
      - Maturity: {{research_data.market_overview.maturity}}
      - Competition: {{competitive_analysis.competitive_landscape.major_players.length}} major players
      
      **Our Opportunity:**
      - Target: {{market_sizing.sam.target_segment}}
      - Position: {{competitive_analysis.our_differentiation.positioning}}
      - Differentiation: {{competitive_analysis.our_differentiation.key_differentiators[0]}}
      
      ---
      
      ## Slide 2: Market Size & Growth
      
      **Total Addressable Market (TAM)**
      - Current: {{market_sizing.tam.value_usd | format_currency}}
      - 5-Year Projection: {{market_metrics.projections.2029 | format_currency}}
      - CAGR: {{market_sizing.tam.growth_rate | format_percent}}
      
      [Chart: TAM Growth Over Time - bar chart showing 2024-2029]
      
      **Geographic Distribution:**
      {{#each market_metrics.geography}}
      - {{@key}}: {{this | format_percent}}
      {{/each}}
      
      ---
      
      ## Slide 3: TAM → SAM → SOM
      
      [Funnel Chart showing TAM → SAM → SOM progression]
      
      **TAM:** {{market_sizing.tam.value_usd | format_currency}}
      {{market_sizing.tam.description}}
      
      **SAM:** {{market_sizing.sam.value_usd | format_currency}}
      {{market_sizing.sam.description}}
      Calculation: {{market_sizing.sam.calculation}}
      
      **SOM (3-Year Target):** {{market_sizing.som.year_3.value_usd | format_currency}}
      {{market_sizing.som.year_3.market_share | format_percent}} market share
      {{market_sizing.som.year_3.description}}
      
      ---
      
      ## Slide 4: Market Drivers
      
      **Why This Market is Growing:**
      
      {{#each research_data.drivers}}
      - {{this}}
      {{/each}}
      
      **Supporting Trends:**
      - Historical CAGR: {{market_metrics.tam.cagr_3yr | format_percent}}
      - Projected CAGR: {{market_metrics.tam.cagr_projected | format_percent}}
      - Acceleration: {{(market_metrics.tam.cagr_projected - market_metrics.tam.cagr_3yr) | format_percent}} increase
      
      ---
      
      ## Slide 5: Competitive Landscape
      
      **Major Players:**
      {{#each competitive_analysis.competitive_landscape.major_players}}
      - {{this.name}} ({{this.market_share_sam | format_percent}} share)
        Strengths: {{this.strengths | join: ', '}}
        Weaknesses: {{this.weaknesses | join: ', '}}
      {{/each}}
      
      **Market Gaps (Our Opportunity):**
      {{#each competitive_analysis.competitive_landscape.market_gaps}}
      - {{this}}
      {{/each}}
      
      ---
      
      ## Slide 6: Our Differentiation
      
      **Positioning:** {{competitive_analysis.our_differentiation.positioning}}
      
      **Key Differentiators:**
      {{#each competitive_analysis.our_differentiation.key_differentiators}}
      - {{this}}
      {{/each}}
      
      **Target Customer:**
      {{competitive_analysis.our_differentiation.target_segment}}
      
      **Strategic Advantages:**
      {{#each competitive_analysis.strategic_advantages}}
      - {{this}}
      {{/each}}
      
      ---
      
      ## Slide 7: 3-Year Revenue Opportunity
      
      [Chart: Revenue Projection showing SOM growth Year 1-3]
      
      **Year 1:** {{market_sizing.som.year_1.value_usd | format_currency}}
      - Market Share: {{market_sizing.som.year_1.market_share | format_percent}}
      - Phase: {{market_sizing.som.year_1.description}}
      
      **Year 2:** {{market_sizing.som.year_2.value_usd | format_currency}}
      - Market Share: {{market_sizing.som.year_2.market_share | format_percent}}
      - Phase: {{market_sizing.som.year_2.description}}
      
      **Year 3:** {{market_sizing.som.year_3.value_usd | format_currency}}
      - Market Share: {{market_sizing.som.year_3.market_share | format_percent}}
      - Phase: {{market_sizing.som.year_3.description}}
      
      ---
      
      ## Slide 8: Key Assumptions & Risks
      
      **Assumptions:**
      {{#each market_sizing.assumptions}}
      - {{this}}
      {{/each}}
      
      **Risks to Mitigate:**
      {{#each market_sizing.risks}}
      - {{this}}
      {{/each}}
      
      **Market Challenges:**
      {{#each research_data.challenges}}
      - {{this}}
      {{/each}}
      
      ---
      
      ## Slide 9: Recommendation
      
      **Market Opportunity Assessment:** ✓ ATTRACTIVE
      
      **Rationale:**
      - Large addressable market ({{market_sizing.tam.value_usd | format_currency}} TAM)
      - Strong growth trajectory ({{market_sizing.tam.growth_rate | format_percent}} CAGR)
      - Clear differentiation opportunity
      - Underserved target segment
      - Achievable market share goals
      
      **Next Steps:**
      1. Validate assumptions with customer interviews
      2. Develop detailed GTM strategy
      3. Build MVP for target segment
      4. Secure funding for market entry
      
      ---
      
      **Presentation Generated:** {{execution.timestamp}}
      **Template:** {{template.name}} v{{template.version}}
      **Research Sources:** {{research_data.market_size.sources | join: ', '}}
    output: executive_presentation
  
  # Stage 6: Generate Final Report
  - name: generate_final_report
    prompt: |
      # Market Opportunity Analysis Report
      
      **Market:** {{input_data.market}}
      **Geography:** {{input_data.geography}}
      **Analysis Date:** {{execution.timestamp}}
      
      ---
      
      ## Executive Summary
      
      This analysis evaluates the market opportunity for {{input_data.market}} in {{input_data.geography}}.
      
      **Key Findings:**
      
      - **TAM:** {{market_sizing.tam.value_usd | format_currency}} growing at {{market_sizing.tam.growth_rate | format_percent}} CAGR
      - **SAM:** {{market_sizing.sam.value_usd | format_currency}} (our addressable market)
      - **3-Year SOM Target:** {{market_sizing.som.year_3.value_usd | format_currency}} ({{market_sizing.som.year_3.market_share | format_percent}} market share)
      
      **Recommendation:** {{recommendation}}
      
      ---
      
      ## Detailed Analysis
      
      [Full presentation content embedded]
      
      {{executive_presentation}}
      
      ---
      
      ## Template Composition Workflow
      
      This analysis was generated using template composition:
      
      1. **Market Research Stage** (web_research_workflow template)
      2. **Data Extraction Stage** (data_extraction_workflow template)
      3. **TAM/SAM/SOM Sizing** (tam_analysis_workflow template)
      4. **Competitive Analysis** (competitive_analysis_workflow template)
      5. **Presentation Generation** (presentation_generator_workflow template)
      
      Each stage is a reusable sub-template that can be used independently or composed into larger workflows.
      
      **Time to Complete:** {{execution.duration}}
      **vs. Manual Research:** 2 weeks (80 hours)
      **Time Savings:** 97.5%
