name: customer_feedback_intelligence
description: Synthesize customer feedback from multiple sources into actionable themes and JIRA tickets
version: 1.0.0
author: Business Intelligence Templates
tags: [business-intelligence, customer-feedback, product-management, multi-source]

config:
  defaults:
    provider: anthropic
    model: claude-3-5-sonnet
    temperature: 0.3
    max_tokens: 6000

steps:
  # Step 1: Collect feedback from all sources in parallel
  - name: collect_all_feedback
    prompt: |
      Simulate collecting customer feedback from multiple sources.
      
      In production, this would query:
      - Zendesk API for support tickets
      - App Store Connect API for iOS reviews  
      - Google Play Developer API for Android reviews
      - Delighted/SurveyMonkey API for NPS
      - Intercom API for chat conversations
      
      For demonstration, structure feedback as:
      ```json
      {
        "feedback_items": [
          {
            "id": "unique_id",
            "source": "zendesk|ios|android|nps|intercom",
            "text": "Customer feedback text",
            "date": "2024-12-28",
            "metadata": {
              "rating": 3,  // if applicable
              "priority": "high",  // if applicable
              "customer_id": "cust_123"
            }
          }
        ],
        "total_count": 5000,
        "by_source": {
          "zendesk": 2000,
          "ios": 1500,
          "android": 1200,
          "nps": 800,
          "intercom": 500
        }
      }
      ```
      
      Note: In real usage, this step would use MCP servers to fetch actual data.
    output: all_feedback

  # Step 2: Categorize feedback items (batch processing for scale)
  - name: categorize_batch
    prompt: |
      Categorize a batch of customer feedback items:
      
      **Feedback Items:**
      {{all_feedback.feedback_items}}
      
      For each item, categorize:
      
      ## Primary Category
      - feature_request: Customer wants new capability
      - bug_report: Something is broken
      - ux_issue: Interface confusing or hard to use
      - performance_issue: Slow, crashes, or hangs
      - pricing_concern: Cost or value proposition
      - integration_request: Connect to other tools
      - customer_success: Positive feedback, success story
      - churn_risk: Threatening to leave or cancel
      - security_concern: Security or privacy issue
      - documentation: Docs missing or unclear
      - other: Doesn't fit above categories
      
      ## Sentiment
      - critical: Urgent, blocking work, severe frustration
      - negative: Frustrated, annoyed, disappointed
      - neutral: Informational, neither positive nor negative
      - positive: Happy, satisfied, praising
      
      ## Priority
      - p0: Critical - immediate action required (churn risk, major bug)
      - p1: High - address this sprint
      - p2: Medium - address in next few sprints
      - p3: Low - nice to have, backlog
      
      ## Affected Feature
      Identify specific feature mentioned (e.g., "export", "dashboard", "mobile_app")
      
      Return categorized results:
      ```json
      {
        "categorized": [
          {
            "id": "fb_001",
            "category": "bug_report",
            "sentiment": "negative",
            "priority": "p0",
            "affected_feature": "export",
            "keywords": ["export", "csv", "broken", "data"]
          }
        ],
        "summary": {
          "total_categorized": 5000,
          "by_category": {
            "bug_report": 987,
            "feature_request": 1245,
            "ux_issue": 745
          },
          "by_sentiment": {
            "critical": 156,
            "negative": 1234,
            "neutral": 2010,
            "positive": 1600
          }
        }
      }
      ```
    output: categorized_feedback

  # Step 3: Extract top themes
  - name: extract_themes
    prompt: |
      Extract the top 10 themes from categorized feedback:
      
      **Categorized Feedback:**
      {{categorized_feedback}}
      
      **Total Items:** {{categorized_feedback.summary.total_categorized}}
      
      Identify patterns and themes:
      
      ## Theme Extraction Process
      
      1. **Group by similarity:** Find feedback items mentioning same issue/feature
      2. **Count frequency:** How many times is this theme mentioned?
      3. **Assess severity:** Based on sentiment and priority
      4. **Calculate impact:** Frequency Ã— severity Ã— business_risk
      
      ## For Each Theme, Provide:
      
      **Theme Details:**
      - Name (concise, descriptive, e.g., "Export Feature Broken")
      - Category (bug_report, feature_request, etc.)
      - Description (1-2 sentences explaining the theme)
      - Frequency (number of mentions)
      - Severity score (1-10, based on sentiment distribution)
      
      **Evidence:**
      - 5 representative customer quotes (actual text from feedback)
      - Sentiment breakdown (count of critical/negative/neutral/positive)
      - Affected customers (if identifiable from metadata)
      
      **Impact Assessment:**
      - Business impact (revenue_risk, churn_risk, growth_opportunity, competitive_pressure)
      - User impact (how many users affected)
      - Urgency (immediate, this_sprint, next_quarter)
      
      **Recommended Action:**
      - Specific action for product team
      - Priority (P0/P1/P2/P3)
      - Estimated effort (if applicable: hours, days, weeks)
      - Suggested owner (Engineering, Product, Design, etc.)
      
      **Rank themes by:** (frequency Ã— severity Ã— business_impact_score)
      
      Return top 10 themes:
      ```json
      {
        "themes": [
          {
            "rank": 1,
            "name": "Export Feature Broken",
            "category": "bug_report",
            "description": "Users unable to export data to CSV for past 2 weeks, causing workflow disruption",
            "frequency": 47,
            "severity": 9,
            "sentiment_breakdown": {
              "critical": 7,
              "negative": 35,
              "neutral": 5,
              "positive": 0
            },
            "representative_quotes": [
              "Export hasn't worked for 2 weeks - had to manually copy data",
              "Critical bug: Can't export our reports anymore",
              "Switching to Competitor because we need reliable exports",
              "Export feature is completely broken on latest version",
              "Please fix export ASAP, this is blocking our entire team"
            ],
            "impact": {
              "business": "HIGH - 3 customers threatened churn ($50K ARR at risk)",
              "users": "~200 users affected (based on mentions + support tickets)",
              "urgency": "immediate"
            },
            "recommended_action": {
              "action": "Fix export bug in next sprint",
              "priority": "P0",
              "estimated_effort": "3 days",
              "owner": "Engineering"
            }
          },
          {
            "rank": 2,
            "name": "Request: Dark Mode",
            "category": "feature_request",
            "description": "Many users requesting dark mode for reduced eye strain",
            "frequency": 156,
            "severity": 5,
            "sentiment_breakdown": {
              "critical": 0,
              "negative": 12,
              "neutral": 89,
              "positive": 55
            },
            "representative_quotes": [
              "Would love a dark mode option",
              "Dark mode would make this app perfect",
              "Please add dark mode - my eyes hurt after long sessions",
              "Competitor has dark mode, would be great if you did too",
              "Dark mode is a must-have for night work"
            ],
            "impact": {
              "business": "MEDIUM - Competitive parity, user satisfaction",
              "users": "156 explicit requests, likely 10Ã— more would use",
              "urgency": "next_quarter"
            },
            "recommended_action": {
              "action": "Add to roadmap for Q2",
              "priority": "P2",
              "estimated_effort": "2 weeks",
              "owner": "Design + Engineering"
            }
          }
        ],
        "summary": {
          "total_themes_found": 10,
          "p0_count": 2,
          "p1_count": 3,
          "p2_count": 4,
          "p3_count": 1
        }
      }
      ```
    output: themes

  # Step 4: Generate action items / JIRA tickets
  - name: generate_action_items
    prompt: |
      Create action items for top themes:
      
      **Themes:**
      {{themes}}
      
      For top {{input_data.top_n_themes | default: 10}} themes, generate JIRA ticket content:
      
      ## Ticket Format
      
      **Title:** [Customer Feedback] {{theme.name}}
      
      **Type:** {{theme.category}}
      
      **Priority:** {{theme.recommended_action.priority}}
      
      **Description:**
      ```
      ## Theme Overview
      {{theme.description}}
      
      **Frequency:** {{theme.frequency}} mentions in last 30 days
      **Severity:** {{theme.severity}}/10
      **Priority:** {{theme.recommended_action.priority}}
      
      ## Customer Evidence
      
      {{#each theme.representative_quotes}}
      - "{{this}}"
      {{/each}}
      
      ## Sentiment Analysis
      
      - Critical (churn risk): {{theme.sentiment_breakdown.critical}}
      - Negative (frustrated): {{theme.sentiment_breakdown.negative}}
      - Neutral: {{theme.sentiment_breakdown.neutral}}
      - Positive: {{theme.sentiment_breakdown.positive}}
      
      ## Business Impact
      
      {{theme.impact.business}}
      
      **Users Affected:** {{theme.impact.users}}
      **Urgency:** {{theme.impact.urgency}}
      
      ## Recommended Action
      
      {{theme.recommended_action.action}}
      
      **Estimated Effort:** {{theme.recommended_action.estimated_effort}}
      **Suggested Owner:** {{theme.recommended_action.owner}}
      ```
      
      **Labels:** customer_feedback, {{theme.category}}, priority_{{theme.recommended_action.priority}}
      
      Return ticket content:
      ```json
      {
        "action_items": [
          {
            "title": "[Customer Feedback] Export Feature Broken",
            "type": "Bug",
            "priority": "P0",
            "description": "Full ticket description...",
            "labels": ["customer_feedback", "bug_report", "priority_p0"],
            "assignee": "Engineering"
          }
        ]
      }
      ```
      
      Note: In production, this would create actual JIRA tickets via MCP server.
    output: action_items

  # Step 5: Generate executive summary report
  - name: generate_summary_report
    prompt: |
      Generate executive summary of customer feedback analysis:
      
      # Customer Feedback Intelligence Report
      
      **Period:** {{input_data.start_date | default: 'Last 30 days'}} to {{input_data.end_date | default: 'Today'}}
      **Total Feedback Analyzed:** {{all_feedback.total_count}}
      **Generated:** {{execution.timestamp}}
      **Template:** {{template.name}} v{{template.version}}
      
      ---
      
      ## Executive Summary
      
      Analyzed {{all_feedback.total_count}} customer feedback items from 5 sources:
      
      **Sources:**
      {{#each all_feedback.by_source}}
      - {{@key}}: {{this}} items
      {{/each}}
      
      **Top 3 Critical Insights:**
      
      {{#each themes.themes[:3]}}
      ### {{@index + 1}}. {{this.name}} 
      **{{this.frequency}} mentions | Severity: {{this.severity}}/10 | Priority: {{this.recommended_action.priority}}**
      
      {{this.description}}
      
      **Impact:** {{this.impact.business}}
      
      **Action:** {{this.recommended_action.action}}
      
      ---
      {{/each}}
      
      ---
      
      ## Category Breakdown
      
      **Feedback by Category:**
      {{#each categorized_feedback.summary.by_category}}
      - {{@key}}: {{this}}
      {{/each}}
      
      **Sentiment Distribution:**
      {{#each categorized_feedback.summary.by_sentiment}}
      - {{@key}}: {{this}}
      {{/each}}
      
      ---
      
      ## Churn Risk Alerts ðŸš¨
      
      **Critical Attention Required:**
      
      {{#each themes.themes}}
      {% if this.sentiment_breakdown.critical > 0 %}
      - **{{this.name}}**: {{this.sentiment_breakdown.critical}} customers expressing churn risk or severe frustration
      {% endif %}
      {{/each}}
      
      {% if themes.themes | filter: 'sentiment_breakdown.critical > 0' | length == 0 %}
      No critical churn risk signals detected.
      {% endif %}
      
      ---
      
      ## Top 10 Themes
      
      {{#each themes.themes}}
      ### {{@index + 1}}. {{this.name}}
      
      **Category:** {{this.category}} | **Frequency:** {{this.frequency}} | **Severity:** {{this.severity}}/10
      
      {{this.description}}
      
      **Sample Quotes:**
      {{#each this.representative_quotes[:3]}}
      - "{{this}}"
      {{/each}}
      
      **Recommendation:** {{this.recommended_action.action}} ({{this.recommended_action.priority}})
      
      ---
      {{/each}}
      
      ---
      
      ## Action Items Created
      
      Created {{action_items.action_items.length}} action items for top themes:
      
      **P0 (Immediate):**
      {{#each action_items.action_items}}
      {% if this.priority == 'P0' %}
      - {{this.title}}
      {% endif %}
      {{/each}}
      
      **P1 (This Sprint):**
      {{#each action_items.action_items}}
      {% if this.priority == 'P1' %}
      - {{this.title}}
      {% endif %}
      {{/each}}
      
      **P2 (Next Quarter):**
      {{#each action_items.action_items}}
      {% if this.priority == 'P2' %}
      - {{this.title}}
      {% endif %}
      {{/each}}
      
      ---
      
      ## Recommendations
      
      **Immediate Actions (P0):**
      {{#each themes.themes}}
      {% if this.recommended_action.priority == 'P0' %}
      - {{this.name}}: {{this.recommended_action.action}}
      {% endif %}
      {{/each}}
      
      **This Sprint (P1):**
      {{#each themes.themes}}
      {% if this.recommended_action.priority == 'P1' %}
      - {{this.name}}: {{this.recommended_action.action}}
      {% endif %}
      {{/each}}
      
      **Roadmap Items (P2):**
      {{#each themes.themes}}
      {% if this.recommended_action.priority == 'P2' %}
      - {{this.name}}: {{this.recommended_action.action}}
      {% endif %}
      {{/each}}
      
      ---
      
      ## Next Steps
      
      1. Review P0 action items with engineering team
      2. Prioritize P1 items for current sprint
      3. Add P2 items to product roadmap
      4. Monitor churn risk customers closely
      5. Schedule follow-up analysis in 30 days
      
      ---
      
      **Automated Analysis:** Yes  
      **Coverage:** 100% of feedback analyzed  
      **Next Run:** {{next_scheduled_run | default: 'Not scheduled (run manually)'}}
