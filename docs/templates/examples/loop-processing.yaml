# Loop Processing Template
# Demonstrates: for_each loops, item variables, array processing

name: loop_processing
description: Process multiple items in a loop
version: 1.0.0
author: MCP-CLI Team
tags: [loops, batch, processing]

config:
  defaults:
    provider: anthropic
    model: claude-sonnet-4

steps:
  # Process each file in the list
  - name: analyze_files
    for_each: "{{files}}"
    item_name: file
    prompt: |
      Analyze file: {{file.name}}
      
      Content:
      {{file.content}}
      
      Provide:
      - File type
      - Purpose
      - Key components
      - Issues found
      
      {% if first %}
      This is the first file in the batch.
      {% endif %}
      
      {% if last %}
      This is the last file. Provide a summary.
      {% endif %}
      
      File {{index}} of {{total}}
    output: file_analyses
  
  # Summarize all analyses
  - name: create_summary
    prompt: |
      Create a summary report from these file analyses:
      
      {{file_analyses}}
      
      Provide:
      1. Overview of all files
      2. Common patterns
      3. Critical issues across files
      4. Recommendations
    output: summary_report

# Usage:
# mcp-cli --template loop_processing --input-data '{
#   "files": [
#     {"name": "main.go", "content": "package main..."},
#     {"name": "utils.go", "content": "package utils..."},
#     {"name": "config.go", "content": "package config..."}
#   ]
# }'
#
# Each file is analyzed individually, then summarized
# Loop variables available: {{file}}, {{index}}, {{first}}, {{last}}
