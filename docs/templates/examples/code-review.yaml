# Code Review Template
# Demonstrates: Multi-step workflow, system prompts, multiple analyses

name: code_review
description: Comprehensive code review with security and quality checks
version: 1.0.0
author: MCP-CLI Team
tags: [code, review, security, quality]

config:
  defaults:
    provider: openai
    model: gpt-4o
    temperature: 0.3  # Lower temperature for focused technical analysis

steps:
  # Step 1: Security Analysis
  - name: security_analysis
    system_prompt: |
      You are a security expert specializing in vulnerability detection.
      Focus on finding security issues, not general code quality.
    prompt: |
      Review this code for security vulnerabilities:
      
      ```
      {{stdin}}
      ```
      
      Check for:
      - SQL injection
      - XSS attacks
      - Authentication/authorization issues
      - Sensitive data exposure
      - Input validation
      
      List findings with severity (Critical, High, Medium, Low).
    output: security_findings
  
  # Step 2: Code Quality Analysis
  - name: quality_analysis
    system_prompt: |
      You are a code quality expert.
      Focus on maintainability, readability, and best practices.
    prompt: |
      Review this code for quality issues:
      
      ```
      {{stdin}}
      ```
      
      Check for:
      - Code smells
      - Naming conventions
      - Function complexity
      - Error handling
      - Documentation
      
      Provide specific recommendations.
    output: quality_findings
  
  # Step 3: Generate Final Report
  - name: create_report
    prompt: |
      Create a comprehensive code review report in markdown format.
      
      Security Findings:
      {{security_findings}}
      
      Quality Findings:
      {{quality_findings}}
      
      Format as:
      # Code Review Report
      
      ## Executive Summary
      [Brief overview of main concerns]
      
      ## Security Analysis
      [Security findings organized by severity]
      
      ## Code Quality
      [Quality issues and recommendations]
      
      ## Priority Actions
      [Top 3-5 items to address first]
      
      ## Conclusion
      [Overall assessment and next steps]
    output: final_report

# Usage:
# Pipe code via stdin:
# cat mycode.go | mcp-cli --template code_review
#
# Or use input-data:
# mcp-cli --template code_review --input-data '{"code": "package main\n..."}'
# (Note: if using input-data, change {{stdin}} to {{input_data.code}} in template)
#
# Output: Complete markdown review report
